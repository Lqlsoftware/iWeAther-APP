<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/app.css" rel="stylesheet"/>
</head>
<body>
	
	<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">
			<!--菜单部分-->
			<aside id="offCanvasSide" class="mui-off-canvas-right">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="content">
<!--
							<p style="margin: 10px 15px;">
								<button id="offCanvasHide" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="padding: 5px 20px;">关闭侧滑菜单</button>
							</p>
-->
						</div>
						<!--<ul class="mui-table-view mui-table-view-chevron mui-table-view-inverted">
							<li class="mui-table-view-cell">
								<a class="mui-navigate-right">
									Item 1
								</a>
							</li>
						</ul>-->
						<div class="menutext">
							<span>其他功能</span><br />
							<span>Jeason正在疯狂开发中。。</span><br />
							<span>T^T</span>
						</div>
						<div class="footer">
							Copy&copy;JeasonStudio 2016
						</div>
					</div>
				</div>
			</aside>
			<div class="mui-inner-wrap">
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
					<div class="mui-scroll">
						<div class="mui-content-padded">
<!--							
							<p style="padding: 5px 20px;margin-bottom: 5px;">
								<button id="offCanvasShow" type="button" class="mui-btn mui-btn-primary mui-btn-block" style="padding: 5px;">
									显示侧滑菜单
								</button>
							</p>
-->
						</div>
				        <div id="weatherIcon">
				        		<img src="img/load.png"/>
				        </div>
				        <div class="citytem">
				        		<br /><br />
				        		<span id="tem">
				        			30
				        		</span> ℃
				        		<br /><br />
				        		<span id="city">
				        			Loading...
				        		</span>
				        		<br /><br />
							<span id="text">
				        			Please Wait...
				        		</span>
				        		
				        </div>
					</div>
					<div id="menu">
    						<a id="offCanvasBtn" href="#offCanvasSide" class="mui-icon mui-action-menu mui-icon-bars mui-pull-right"></a>
			       </div>
				</div>
				<!-- off-canvas backdrop -->
				<div class="mui-off-canvas-backdrop"></div>
			</div>
		</div>

		<script>
		mui.init({
			swipeBack: false,
		});
		var Ucity = "Beijing";
		mui.plusReady(function() {

			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} else {
				mui.alert("Geolocation is not supported by this browser.");
			}

			function showPosition(position) {
				mui.ajax('http://maps.google.com/maps/api/geocode/json?latlng='+position.coords.latitude+','+position.coords.longitude+'&language=zh-CN&sensor=false',{
					dataType: 'JSON',
					timeout: 10000,
					success: function(data){
						var locationobj = eval("("+data+")");
						var locationname = locationobj.results[0].address_components[0].short_name;
						var locationarea = locationobj.results[0].address_components[1].short_name;
						var locationcity = locationobj.results[0].address_components[2].short_name;
						Ucity = locationcity;
						document.getElementById("city").innerHTML = locationcity + " " + locationarea + " " + locationname;
					},
					error: function(xhr, type, errorThrown) {//异常处理；
						console.log(type);
						mui.toast("😔Some Mistakes😔")
					}
				})
			};

			mui.ajax('https://query.yahooapis.com/v1/public/yql?q=select * from weather.forecast where woeid in (select woeid from geo.places(1) where text="' + Ucity + '")&format=json',{
					dataType: 'JSON',
					timeout: 10000,
					success: function(data) {
						var obj = eval("("+data+")");
						var arr = obj.query.results.channel;
						
						document.getElementById("tem").innerHTML = parseInt((arr.item.condition.temp-32)/1.8);
						document.getElementById("text").innerHTML = arr.item.condition.text;
						var code = arr.item.condition.code;
						document.getElementById("weatherIcon").innerHTML = '<img src="weatherIcon/'+ code +'.png"/>';
					},
						error: function(xhr, type, errorThrown) {//异常处理；
						console.log(type);
						mui.toast("😔Some Mistakes😔")
					}
				});
			});
			
			 //侧滑容器父节点
			var offCanvasWrapper = mui('#offCanvasWrapper');
			 //主界面容器
			var offCanvasInner = offCanvasWrapper[0].querySelector('.mui-inner-wrap');
			 //菜单容器
			var offCanvasSide = document.getElementById("offCanvasSide");

			 //移动效果是否为整体移动
			var moveTogether = false;
			 //侧滑容器的class列表，增加.mui-slide-in即可实现菜单移动、主界面不动的效果；
			var classList = offCanvasWrapper[0].classList;

			offCanvasSide.classList.remove('mui-transitioning');
			offCanvasSide.setAttribute('style', '');
			classList.remove('mui-slide-in');
			classList.remove('mui-scalable');
			offCanvasWrapper[0].insertBefore(offCanvasSide, offCanvasWrapper[0].firstElementChild);
			classList.add('mui-scalable');
			offCanvasWrapper.offCanvas().refresh();


			document.getElementById('offCanvasShow').addEventListener('tap', function() {
				offCanvasWrapper.offCanvas('show');
			});
			document.getElementById('offCanvasHide').addEventListener('tap', function() {
				offCanvasWrapper.offCanvas('close');
			});
			 //主界面和侧滑菜单界面均支持区域滚动；
			mui('#offCanvasSideScroll').scroll();
			mui('#offCanvasContentScroll').scroll();
			 //实现ios平台的侧滑关闭页面；
			if (mui.os.plus && mui.os.ios) {
				offCanvasWrapper[0].addEventListener('shown', function(e) { //菜单显示完成事件
					plus.webview.currentWebview().setStyle({
						'popGesture': 'none'
					});
				});
				offCanvasWrapper[0].addEventListener('hidden', function(e) { //菜单关闭完成事件
					plus.webview.currentWebview().setStyle({
						'popGesture': 'close'
					});
				});
			}
		</script>
	
</body>
</html>